<div class="container py-5">
  <div class="card shadow-lg border-0 rounded-4">
    <div class="card-body text-center px-5 py-4">

      <!-- ✅ Profile Photo -->
      <div class="mb-4">
        <img
          [src]="getPhotoUrl()"
          (click)="openPhotoModal()"
          (error)="onImgError($event)"
          alt="Profile Photo"
          class="rounded-circle border border-3 border-primary shadow-sm"
          style="width: 130px; height: 130px; object-fit: cover; cursor: pointer;"
          title="Click to enlarge photo"
        />
      </div>

      <!-- ✅ Name & Role -->
      <h4 class="fw-bold text-dark mb-1">{{ employee.fname }} {{ employee.lname }}</h4>
      <p class="text-muted">
        <i class="bi bi-briefcase"></i> {{ employee.designation }} |
        <i class="bi bi-building"></i> {{ employee.department }}
      </p>

      <!-- ✅ Score & Status (added) -->
      <div class="d-flex justify-content-center gap-4 my-3">
        <div class="text-center">
          <div class="small text-muted">Resume Score</div>
          <div class="h5">{{ employee.resumeScore ?? 0 }} / 100</div>
          <div class="progress" style="height: 8px; width:220px;">
            <div class="progress-bar" role="progressbar" [style.width.%]="employee.resumeScore ?? 0"></div>
          </div>
        </div>

        <div class="text-center">
          <div class="small text-muted">Status</div>
          <div class="mt-1">
            <span class="badge"
                  [ngClass]="{'bg-success': employee.resumeStatus === 'SHORTLISTED', 'bg-warning': employee.resumeStatus === 'REVIEW', 'bg-secondary': !employee.resumeStatus}">
              {{ employee.resumeStatus || 'UPLOADED' }}
            </span>
          </div>
        </div>
      </div>

      <!-- ✅ Employee Info Table -->
      <div class="table-responsive mb-4">
        <table class="table table-bordered table-striped align-middle shadow-sm">
          <tbody>
            <tr>
              <th class="bg-light text-primary" style="width: 200px;">Employee ID</th>
              <td>#{{ employee.id }}</td>
            </tr>
            <tr>
              <th class="bg-light text-primary">Email</th>
              <td>
                <a [href]="'mailto:' + employee.email" class="text-dark text-decoration-none">
                  <i class="bi bi-envelope"></i> {{ employee.email }}
                </a>
              </td>
            </tr>
            <tr>
              <th class="bg-light text-primary">Salary</th>
              <td><i class="bi bi-currency-rupee"></i> {{ employee.salary }}</td>
            </tr>
            <tr>
              <th class="bg-light text-primary">Joining Date</th>
              <td><i class="bi bi-calendar-check"></i> {{ employee.joiningDate }}</td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- ✅ Parsed Data (if available) -->
      <div *ngIf="parsedJson" class="text-start mb-3 w-100">
        <h5 class="mb-2">Parsed Resume Data</h5>
        <pre class="bg-light p-3 rounded" style="max-height:300px; overflow:auto;">{{ parsedJson | json }}</pre>
      </div>

      <div *ngIf="!parsedJson" class="text-muted mb-3">Parsed resume JSON not available. You can preview the resume or run re-score.</div>

      <!-- ✅ Resume Buttons -->
      <div class="d-flex justify-content-center gap-3 mb-3">
        <button (click)="openResumeModal()"
                class="btn btn-outline-primary rounded-pill shadow-sm">
          <i class="bi bi-file-earmark-pdf"></i> View Resume
        </button>

        <a [href]="getResumeDownloadUrl()" class="btn btn-primary rounded-pill shadow-sm" target="_blank">
          <i class="bi bi-download"></i> Download Resume
        </a>
      </div>

      <!-- ✅ Re-score control -->
      <div class="mt-3 d-flex justify-content-center align-items-center gap-2 w-100">
        <input type="number"
               class="form-control form-control-sm"
               placeholder="Job ID for scoring"
               [(ngModel)]="jobIdForScoring"
               style="width:180px;" />
        <button class="btn btn-success" (click)="reScoreNow()" [disabled]="scoringInProgress">
          <i class="bi bi-percent"></i>
          <span *ngIf="!scoringInProgress">Run Re-score</span>
          <span *ngIf="scoringInProgress">Scoring...</span>
        </button>
      </div>

      <!-- ✅ Navigation Buttons -->
      <div class="mt-4 d-flex justify-content-center gap-3">
        <button class="btn btn-secondary rounded-pill px-4"
                [routerLink]="['/updating-by-id', employee.id]">
          <i class="bi bi-pencil"></i> Update
        </button>

        <button class="btn btn-danger rounded-pill px-4" routerLink="/show-all-employees">
          <i class="bi bi-arrow-left-circle"></i> Back
        </button>
      </div>
    </div>
  </div>
</div>

<!-- ✅ Photo Modal -->
<div class="modal fade" id="photoModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-lg">
    <div class="modal-content">
      <div class="modal-header bg-primary text-white">
        <h5 class="modal-title"><i class="bi bi-person-bounding-box"></i> Profile Photo</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body text-center">
        <img [src]="getPhotoUrl()" (error)="onImgError($event)"
             class="img-fluid rounded shadow" style="max-height: 600px;" />
      </div>
    </div>
  </div>
</div>

<!-- ✅ Resume Modal -->
<div class="modal fade" id="resumeModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-xl modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header bg-primary text-white">
        <h5 class="modal-title"><i class="bi bi-file-earmark-pdf"></i> Resume Preview</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <iframe [src]="safeResumeUrl"
                width="100%"
                height="600"
                frameborder="0"
                class="shadow-sm rounded"></iframe>
      </div>
    </div>
  </div>
</div>
