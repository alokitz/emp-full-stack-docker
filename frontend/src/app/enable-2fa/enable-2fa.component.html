<div class="enable-2fa card shadow p-4 text-center">
  <h3 class="text-primary mb-3">Enable 2-Factor Authentication (2FA)</h3>

  <div *ngIf="loading" class="mb-3">
    <div class="spinner-border text-primary" role="status"><span class="visually-hidden">Loading...</span></div>
    <p class="mt-2">Generating 2FA key...</p>
  </div>

  <div *ngIf="errorMsg" class="alert alert-danger">{{ errorMsg }}</div>

  <div *ngIf="!loading && qrData" class="my-3 d-flex flex-column align-items-center">
    <img *ngIf="qrImage" [src]="qrImage" alt="QR Code" class="my-3" width="200" height="200" />
    <div *ngIf="!qrImage" class="small text-muted">QR not available â€” use secret below.</div>
    <p class="mt-2 text-muted small">(Scan this QR using Google Authenticator)</p>
  </div>

  <div *ngIf="!loading && secret" class="alert alert-secondary">
    <strong>Secret:</strong> {{ secret }}
  </div>

  <div class="mt-3">
    <p>After scanning, enter the current 6-digit code from your authenticator app:</p>

    <!-- name attribute is important for ngModel in template-driven forms -->
    <input type="text"
           name="otp"
           maxlength="6"
           class="form-control text-center mx-auto"
           style="width: 150px;"
           [(ngModel)]="code"
           placeholder="123456" />

    <!-- debug (remove in production) -->
    <!-- <p class="mt-2">DEBUG code = "{{ code }}"</p> -->
  </div>

  <div class="mt-4">
    <button class="btn btn-success"
            [disabled]="!isValidCode() || confirming"
            (click)="confirm()">
      <i class="bi bi-shield-lock me-2"></i>
      {{ confirming ? 'Verifying...' : 'Confirm & Enable' }}
    </button>
  </div>
</div>
